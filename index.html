<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tabla de Clasificaci贸n</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="loader">
      <div class="loader-circle"></div>
    </div>

    <div class="container">
      <div class="header">
        <div class="share-btn">
          <svg viewBox="0 0 24 24">
            <path
              d="M16 10v7H2V9h12m6-1h-1V7c0-1.1-.9-2-2-2h-4.18C9.6 3.4 8.84 3 8 3c-1.1 0-2 .9-2 2v1H2c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-1h1c1.1 0 2-.9 2-2V11c0-1.1-.9-2-2-2z"
            />
          </svg>
        </div>
      </div>

      <div class="title">
        <svg viewBox="0 0 24 24">
          <path
            d="M12 1l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 1z"
          />
        </svg>
        Tabla de Clasificaci贸n
      </div>

      <div class="ranking-table">
        <!-- Added header row with new column names -->
        <div class="table-row">
          <div class="header-text">Posici贸n</div>
          <div></div>
          <div class="header-text">Nombre</div>
          <div class="header-text">Partidas Ganadas</div>
          <div class="header-text">Partidas Perdidas</div>
          <div class="header-text">Puntos totales</div>
        </div>

        <div class="table-row">
          <div class="position">#1</div>
          <div class="avatar avatar-1">B</div>
          <div class="player-name">biped</div>
          <div class="stat-value">9</div>
          <div class="stat-value">11</div>
          <div class="stat-value">204</div>
        </div>

        <div class="table-row">
          <div class="position">#2</div>
          <div class="avatar avatar-2">P</div>
          <div class="player-name">patry</div>
          <div class="stat-value">1</div>
          <div class="stat-value">0</div>
          <div class="stat-value">20</div>
        </div>

        <div class="table-row">
          <div class="position">#3</div>
          <div class="avatar avatar-3">L</div>
          <div class="player-name">Luis22</div>
          <div class="stat-value">0</div>
          <div class="stat-value">0</div>
          <div class="stat-value">10</div>
        </div>

        <div class="table-row">
          <div class="position">#4</div>
          <div class="avatar avatar-4">A</div>
          <div class="player-name">antu</div>
          <div class="stat-value">0</div>
          <div class="stat-value">0</div>
          <div class="stat-value">0</div>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBGDnwubqpveLZIPXFnlETnZFiv1ogM5t4",
        authDomain: "hangmanapp-e34ef.firebaseapp.com",
        projectId: "hangmanapp-e34ef",
        storageBucket: "hangmanapp-e34ef.firebasestorage.app",
        messagingSenderId: "613139740415",
        appId: "1:613139740415:web:513fa34beffbb4c144beca",
        measurementId: "G-7RHCNVKRJ4",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      //  Obtener los usuarios desde Firestore
      async function obtenerUsuarios() {
        try {
          const usuariosCol = collection(db, "usuarios");
          const snapshot = await getDocs(usuariosCol);
          const lista = snapshot.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));

          console.log("Usuarios obtenidos desde Firestore:", lista);

          //  Ordenar por puntos de mayor a menor
          lista.sort((a, b) => (b.puntos ?? 0) - (a.puntos ?? 0));

          //  Mostrar en la tabla
          renderTabla(lista);
        } catch (error) {
          console.error("Error al obtener usuarios:", error);
        }
      }

      //  Renderiza los datos en la tabla HTML
      function renderTabla(usuarios) {
        const tabla = document.querySelector(".ranking-table");

        tabla.innerHTML = `
      <div class="table-row">
        <div class="header-text">Posici贸n</div>
        <div></div>
        <div class="header-text">Nombre</div>
        <div class="header-text">Partidas Ganadas</div>
        <div class="header-text">Partidas Perdidas</div>
        <div class="header-text">Puntos totales</div>
      </div>
    `;

        usuarios.forEach((usuario, index) => {
          const nombreJugador = usuario.nombreUsuario || "Sin nombre";

          const fila = document.createElement("div");
          fila.classList.add("table-row");

          fila.innerHTML = `
        <div class="position">#${index + 1}</div>
        <div class="avatar avatar-${index + 1}">
          ${nombreJugador.charAt(0).toUpperCase()}
        </div>
        <div class="player-name">${nombreJugador}</div>
        <div class="stat-value">${usuario.partidasGanadas ?? 0}</div>
        <div class="stat-value">${usuario.partidasPerdidas ?? 0}</div>
        <div class="stat-value">${usuario.puntos ?? 0}</div>
      `;

          tabla.appendChild(fila);
        });
      }

      // Ejecutar cuando la p谩gina cargue
      document.addEventListener("DOMContentLoaded", obtenerUsuarios);
    </script>
  </body>
</html>
